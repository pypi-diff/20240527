# Comparing `tmp/asktable-0.14.3-py3-none-any.whl.zip` & `tmp/asktable-0.17.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,36 +1,38 @@
-Zip file size: 32856 bytes, number of entries: 34
--rw-r--r--  2.0 unx       86 b- defN 24-May-01 14:48 asktable/__init__.py
--rw-r--r--  2.0 unx     2180 b- defN 24-May-06 10:32 asktable/api.py
--rw-r--r--  2.0 unx     2138 b- defN 24-May-18 07:11 asktable/cli.py
--rw-r--r--  2.0 unx     1022 b- defN 24-May-18 07:11 asktable/client.py
--rw-r--r--  2.0 unx       41 b- defN 24-May-01 14:48 asktable/exceptions.py
--rw-r--r--  2.0 unx      875 b- defN 24-May-01 14:48 asktable/log.py
--rw-r--r--  2.0 unx     1492 b- defN 24-May-01 14:48 asktable/upload.py
--rw-r--r--  2.0 unx      248 b- defN 24-May-18 07:11 asktable/models/__init__.py
--rw-r--r--  2.0 unx     2992 b- defN 24-May-18 07:22 asktable/models/client_base.py
--rw-r--r--  2.0 unx     2571 b- defN 24-May-18 07:11 asktable/models/client_chat.py
--rw-r--r--  2.0 unx    10755 b- defN 24-May-18 07:29 asktable/models/client_ds.py
--rw-r--r--  2.0 unx     1270 b- defN 24-May-18 07:11 asktable/models/client_msg.py
--rw-r--r--  2.0 unx      885 b- defN 24-May-01 14:48 asktable/models/client_run.py
--rw-r--r--  2.0 unx     1397 b- defN 24-May-18 07:11 asktable/models/client_securetunnel.py
--rw-r--r--  2.0 unx        0 b- defN 24-May-01 14:48 atcommon/__init__.py
--rw-r--r--  2.0 unx     3828 b- defN 24-May-10 15:22 atcommon/tools.py
--rw-r--r--  2.0 unx       16 b- defN 24-May-18 07:30 atcommon/version.py
--rw-r--r--  2.0 unx        0 b- defN 24-May-01 14:48 atcommon/exceptions/__init__.py
--rw-r--r--  2.0 unx     1402 b- defN 24-May-04 12:53 atcommon/exceptions/client.py
--rw-r--r--  2.0 unx       95 b- defN 24-May-01 14:48 atcommon/exceptions/server.py
--rw-r--r--  2.0 unx     2837 b- defN 24-May-18 07:11 atcommon/exceptions/server_base.py
--rw-r--r--  2.0 unx      764 b- defN 24-May-01 14:48 atcommon/exceptions/server_plugins.py
--rw-r--r--  2.0 unx      526 b- defN 24-May-18 07:11 atcommon/models/__init__.py
--rw-r--r--  2.0 unx      731 b- defN 24-May-18 07:11 atcommon/models/base.py
--rw-r--r--  2.0 unx     4918 b- defN 24-May-18 07:11 atcommon/models/bi.py
--rw-r--r--  2.0 unx     1069 b- defN 24-May-18 07:11 atcommon/models/chat.py
--rw-r--r--  2.0 unx     1424 b- defN 24-May-18 07:11 atcommon/models/datasource.py
--rw-r--r--  2.0 unx    27794 b- defN 24-May-18 07:11 atcommon/models/meta.py
--rw-r--r--  2.0 unx      819 b- defN 24-May-18 07:11 atcommon/models/securetunnel.py
--rw-r--r--  2.0 unx    11702 b- defN 24-May-18 07:32 asktable-0.14.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-May-18 07:32 asktable-0.14.3.dist-info/WHEEL
--rw-r--r--  2.0 unx       47 b- defN 24-May-18 07:32 asktable-0.14.3.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       18 b- defN 24-May-18 07:32 asktable-0.14.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2765 b- defN 24-May-18 07:32 asktable-0.14.3.dist-info/RECORD
-34 files, 88799 bytes uncompressed, 28440 bytes compressed:  68.0%
+Zip file size: 39363 bytes, number of entries: 36
+-rw-r--r--  2.0 unx       86 b- defN 24-Apr-02 15:29 asktable/__init__.py
+-rw-r--r--  2.0 unx     2180 b- defN 24-Apr-01 06:16 asktable/api.py
+-rw-r--r--  2.0 unx     2213 b- defN 24-May-27 04:16 asktable/cli.py
+-rw-r--r--  2.0 unx     1395 b- defN 24-May-27 04:16 asktable/client.py
+-rw-r--r--  2.0 unx       41 b- defN 24-Apr-01 06:16 asktable/exceptions.py
+-rw-r--r--  2.0 unx      875 b- defN 24-Apr-01 06:44 asktable/log.py
+-rw-r--r--  2.0 unx     1492 b- defN 24-Apr-01 06:16 asktable/upload.py
+-rw-r--r--  2.0 unx      584 b- defN 24-May-27 04:16 asktable/models/__init__.py
+-rw-r--r--  2.0 unx     4495 b- defN 24-May-27 04:16 asktable/models/client_auth.py
+-rw-r--r--  2.0 unx     4023 b- defN 24-May-27 04:16 asktable/models/client_base.py
+-rw-r--r--  2.0 unx     2785 b- defN 24-May-27 04:16 asktable/models/client_chat.py
+-rw-r--r--  2.0 unx    10830 b- defN 24-May-27 04:16 asktable/models/client_ds.py
+-rw-r--r--  2.0 unx     1290 b- defN 24-May-27 04:16 asktable/models/client_msg.py
+-rw-r--r--  2.0 unx      885 b- defN 24-Apr-06 09:09 asktable/models/client_run.py
+-rw-r--r--  2.0 unx     1597 b- defN 24-May-27 04:16 asktable/models/client_securetunnel.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Dec-08 14:27 atcommon/__init__.py
+-rw-r--r--  2.0 unx     3964 b- defN 24-May-27 04:16 atcommon/tools.py
+-rw-r--r--  2.0 unx       16 b- defN 24-May-27 04:17 atcommon/version.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Jan-31 13:33 atcommon/exceptions/__init__.py
+-rw-r--r--  2.0 unx     1402 b- defN 24-Apr-16 12:45 atcommon/exceptions/client.py
+-rw-r--r--  2.0 unx       95 b- defN 24-Apr-01 06:16 atcommon/exceptions/server.py
+-rw-r--r--  2.0 unx     4174 b- defN 24-May-27 04:16 atcommon/exceptions/server_base.py
+-rw-r--r--  2.0 unx      656 b- defN 24-May-27 04:16 atcommon/exceptions/server_plugins.py
+-rw-r--r--  2.0 unx      763 b- defN 24-May-27 04:16 atcommon/models/__init__.py
+-rw-r--r--  2.0 unx     1095 b- defN 24-May-27 04:16 atcommon/models/auth.py
+-rw-r--r--  2.0 unx     1063 b- defN 24-May-27 04:16 atcommon/models/base.py
+-rw-r--r--  2.0 unx     1326 b- defN 24-May-27 04:16 atcommon/models/chat.py
+-rw-r--r--  2.0 unx     1594 b- defN 24-May-27 04:16 atcommon/models/datasource.py
+-rw-r--r--  2.0 unx    37127 b- defN 24-May-27 04:16 atcommon/models/meta.py
+-rw-r--r--  2.0 unx     5061 b- defN 24-May-27 04:16 atcommon/models/qa.py
+-rw-r--r--  2.0 unx     1137 b- defN 24-May-27 04:16 atcommon/models/securetunnel.py
+-rw-r--r--  2.0 unx    18288 b- defN 24-May-27 06:18 asktable-0.17.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-May-27 06:18 asktable-0.17.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       47 b- defN 24-May-27 06:18 asktable-0.17.0.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       18 b- defN 24-May-27 06:18 asktable-0.17.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2934 b- defN 24-May-27 06:18 asktable-0.17.0.dist-info/RECORD
+36 files, 115623 bytes uncompressed, 34689 bytes compressed:  70.0%
```

## zipnote {}

```diff
@@ -18,14 +18,17 @@
 
 Filename: asktable/upload.py
 Comment: 
 
 Filename: asktable/models/__init__.py
 Comment: 
 
+Filename: asktable/models/client_auth.py
+Comment: 
+
 Filename: asktable/models/client_base.py
 Comment: 
 
 Filename: asktable/models/client_chat.py
 Comment: 
 
 Filename: asktable/models/client_ds.py
@@ -63,41 +66,44 @@
 
 Filename: atcommon/exceptions/server_plugins.py
 Comment: 
 
 Filename: atcommon/models/__init__.py
 Comment: 
 
-Filename: atcommon/models/base.py
+Filename: atcommon/models/auth.py
 Comment: 
 
-Filename: atcommon/models/bi.py
+Filename: atcommon/models/base.py
 Comment: 
 
 Filename: atcommon/models/chat.py
 Comment: 
 
 Filename: atcommon/models/datasource.py
 Comment: 
 
 Filename: atcommon/models/meta.py
 Comment: 
 
+Filename: atcommon/models/qa.py
+Comment: 
+
 Filename: atcommon/models/securetunnel.py
 Comment: 
 
-Filename: asktable-0.14.3.dist-info/METADATA
+Filename: asktable-0.17.0.dist-info/METADATA
 Comment: 
 
-Filename: asktable-0.14.3.dist-info/WHEEL
+Filename: asktable-0.17.0.dist-info/WHEEL
 Comment: 
 
-Filename: asktable-0.14.3.dist-info/entry_points.txt
+Filename: asktable-0.17.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: asktable-0.14.3.dist-info/top_level.txt
+Filename: asktable-0.17.0.dist-info/top_level.txt
 Comment: 
 
-Filename: asktable-0.14.3.dist-info/RECORD
+Filename: asktable-0.17.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## asktable/cli.py

```diff
@@ -31,23 +31,23 @@
     encrypted_token = encrypt_the_str(args.token)
     print(f"\n-- AskTable 客户端({at.version})初始化...")
     print("-- 连接服务器(-a)：", args.api_url)
     try:
         response = requests.get("https://www.baidu.com")
         response.raise_for_status()
     except requests.exceptions.RequestException as e:
-        print("--本机网络异常")
+        print("\n[ERROR]连接服务器异常！请检查本机网络...\n")
         return
     try:
         t = at.token_id
     except Unauthorized:
         print(f"-- 使用Token (-t)： Token '{args.token}' 无效，请检查是否正确。")
         return
     except ServerConnectionError:
-        print(f"--服务器连接异常...")
+        print(f"\n[ERROR]连接服务器异常！请检查服务器状态...\n")
         return
     print("-- 使用Token (-t)：", encrypted_token)
     print("-- 您可以使用 'at' 来访问 AskTable，比如：通过 'at.datasources' 来查询数据源列表")
     print("   完整的使用方法，请参考帮助文档：https://pypi.org/project/asktable/\n")
 
     try:
         # 尝试导入 IPython
```

## asktable/client.py

```diff
@@ -1,36 +1,52 @@
-from asktable.models import DataResourceList, ChatList, SecureTunnelList
+from asktable import models
 from asktable.api import APIRequest
 from atcommon.version import VERSION
+from asktable import exceptions as errors
 
 
 class AskTable:
     __version__ = VERSION
     version = VERSION
 
+    DataSource = models.DataSourceClientModel
+    Policy = models.AuthPolicyClient
+    Role = models.AuthRoleClient
+
+    errors = errors
+
     def __init__(self, api_url='https://api.asktable.com',
                  token='token1', debug=False, user_id=None):
         self.api_url = api_url
         self.token = token
         self.debug = debug
         self.user_id = user_id
 
     @property
     def api(self):
         return APIRequest(api_url=self.api_url, token=self.token, debug=self.debug, user_id=self.user_id)
 
     @property
     def datasources(self):
-        return DataResourceList(api=self.api, endpoint="/datasources")
+        return models.DataSourceList(api=self.api, endpoint="/datasources")
 
     @property
     def chats(self):
-        return ChatList(api=self.api, endpoint="/chats")
+        return models.ChatList(api=self.api, endpoint="/chats")
 
     @property
     def securetunnels(self):
-        return SecureTunnelList(api=self.api, endpoint="/securetunnels")
+        return models.SecureTunnelList(api=self.api, endpoint="/securetunnels")
+
+    @property
+    def roles(self):
+        return models.AuthRoleList(self.api, endpoint="/auth/roles")
+
+    @property
+    def policies(self):
+        return models.AuthPolicyList(self.api, endpoint="/auth/policies")
+
 
     @property
     def token_id(self):
         return self.api.send(endpoint="/account/token", method="GET")
```

## asktable/models/__init__.py

```diff
@@ -1,9 +1,17 @@
-from asktable.models.client_ds import DataResourceList
+from asktable.models.client_ds import DataSourceList, DataSourceClientModel
 from asktable.models.client_chat import ChatList
+from asktable.models.client_msg import MessageClientModel, MessageList
 from asktable.models.client_securetunnel import SecureTunnelList
+from asktable.models.client_auth import AuthRoleList, AuthPolicyList, AuthRoleClient, AuthPolicyClient
 
 __ALL__ = [
-    "DataResourceList",
+    "DataSourceList",
     "ChatList",
     "SecureTunnelList",
+    "AuthRoleList",
+    "AuthPolicyList",
+    "DataSourceClientModel",
+    "AuthRoleClient",
+    "AuthPolicyClient",
+    "MessageClientModel",
 ]
```

## asktable/models/client_base.py

```diff
@@ -13,39 +13,46 @@
             # 如果返回的是JSON or List对象
             if isinstance(json_or_list_data, list):
                 obj_list = []
                 for json_data in json_or_list_data:
                     obj = cls.load_from_dict(json_data)
                     # 将API对象传递给Model对象（从函数的第一个参数 self 中获取）
                     obj.api = args[0].api
+                    obj.endpoint = args[0].endpoint
                     obj_list.append(obj)
                 return obj_list
             elif isinstance(json_or_list_data, dict):
                 obj = cls.load_from_dict(json_or_list_data)
                 # 将API对象传递给Model对象（从函数的第一个参数 self 中获取）
                 obj.api = args[0].api
+                obj.endpoint = args[0].endpoint
                 return obj
+            elif json_or_list_data is None:
+                return None
+            elif isinstance(json_or_list_data, BaseResourceList):
+                return json_or_list_data
             else:
                 log.error(f"Unsupported data type: {type(json_or_list_data)}")
-                raise ValueError("Unsupported data type")
+                raise ValueError(f"Unsupported data type {type(json_or_list_data)}")
 
         return wrapper
 
     return decorator
 
 
 class BaseResourceList:
     __do_not_print_properties__ = []
 
-    def __init__(self, api: APIRequest, endpoint: str, order='desc', page_size=20, page_number=1):
+    def __init__(self, api: APIRequest, endpoint: str, order='desc', page_size=20, page_number=1, extra_params=None):
         self.api = api
         self.endpoint = endpoint
         self.order = order
         self.page_size = page_size
         self.page_number = page_number
+        self.extra_params = extra_params if extra_params else {}
 
     def __iter__(self):
         # 实现迭代器协议，允许直接迭代资源列表
         self._current = 0
         self._resources = self._get_all_resources() or []
         return self
 
@@ -59,32 +66,49 @@
     def _get_all_resources(self):
         raise NotImplementedError
 
     def _get_all_resources_request(self):
         params = {
             "order": self.order,
             "page_number": self.page_number,
-            "page_size": self.page_size
+            "page_size": self.page_size,
+            **self.extra_params
         }
+
         response = self.api.send(endpoint=self.endpoint, method="GET", params=params)
 
         data = response.get('data', [])
         return data
 
+    def _get_latest_one_or_none(self):
+        x = self._get_all_resources_request()
+        if x:
+            return x[0]
+        else:
+            return None
+
     def to_dict(self):
         return [resource.to_dict() for resource in self]
 
     def __repr__(self):
         # 将资源转换为字典列表
         resources_dicts = self.to_dict()
 
         # 去掉 __do_not_print_properties__ 字段
         if self.__do_not_print_properties__:
             for ds in resources_dicts:
                 for i in self.__do_not_print_properties__:
                     ds.pop(i)
 
+        # 截断长值
+        max_start_length = 70  # 设置前面部分最大长度
+        max_end_length = 30  # 设置后面部分最大长度
+        for ds in resources_dicts:
+            for key, value in ds.items():
+                if isinstance(value, str) and len(value) > (max_start_length + max_end_length):
+                    ds[key] = value[:max_start_length] + "........" + value[-max_end_length:]  # 截断并添加省略号
+
         # 使用 tabulate 来生成表格格式的字符串
         return tabulate(resources_dicts, headers="keys", tablefmt="plain")
 
     def count(self):
         return len(self._get_all_resources())
```

## asktable/models/client_chat.py

```diff
@@ -1,80 +1,80 @@
-from datetime import datetime
 from atcommon.models import ChatCore
 from atcommon.tools import format_time_ago
 from asktable.models.client_base import convert_to_object, BaseResourceList
 from asktable.models.client_run import RunList
 from asktable.models.client_msg import MessageList, MessageClientModel
+from asktable.api import APIRequest
 
 
 class ChatClientModel(ChatCore):
-
+    api: APIRequest
+    endpoint: str
 
     def delete(self):
-        return self.api.send(endpoint=f"/chats/{self.id}", method="DELETE")
+        return self.api.send(endpoint=f"{self.endpoint}/{self.id}", method="DELETE")
 
     @property
     def runs(self):
-        return RunList(self.api, endpoint=f"/chats/{self.id}/runs")
+        return RunList(self.api, endpoint=f"{self.endpoint}/{self.id}/runs")
 
     @property
     def messages(self):
-        return MessageList(self.api, endpoint=f"/chats/{self.id}/messages")
+        return MessageList(self.api, endpoint=f"{self.endpoint}/{self.id}/messages")
 
     @convert_to_object(cls=MessageClientModel)
-    def ask(self, question):
+    def ask(self, question) -> MessageClientModel:
         # 提问
         data = {"question": question}
-        return self.api.send(endpoint=f"/chats/{self.id}", method="POST",
-                             data=data)
+        return self.api.send(endpoint=f"{self.endpoint}/{self.id}", method="POST", data=data)
 
 
 class ChatList(BaseResourceList):
     __do_not_print_properties__ = ['tenant_id']
 
-    def _my_format_time(self, ts: int or None):
-        if not ts:
-            return ''
-        local_ts_readable = format_time_ago(ts)
-        return local_ts_readable
 
     @convert_to_object(cls=ChatClientModel)
     def _get_all_resources(self):
         return self._get_all_chats()
 
     def _get_all_chats(self):
         chats = self._get_all_resources_request()
         # 转换 created 字段
         for chat in chats:
-            chat['created'] = self._my_format_time(chat['created'])
-            chat['latest_msg'] = self._my_format_time(chat['latest_msg'])
+            chat['created'] = format_time_ago(chat['created'])
+            chat['latest_msg'] = format_time_ago(chat['latest_msg'])
         return chats
 
     @property
     @convert_to_object(cls=ChatClientModel)
     def latest(self):
-        # 获取最后一个资源
-        x = self._get_all_chats()
-        if x:
-            return x[0]
-        else:
-            return None
+        return self._get_latest_one_or_none()
 
     def page(self, page_number=1):
         return ChatList(self.api, self.endpoint, page_number=page_number)
 
     def all(self):
         return ChatList(self.api, self.endpoint, page_number=0, page_size=0)
 
     @convert_to_object(cls=ChatClientModel)
     def get(self, id):
         # 通过资源ID来获取
         return self.api.send(endpoint=f"{self.endpoint}/{id}", method="GET")
 
     @convert_to_object(cls=ChatClientModel)
-    def create(self, datasource_ids: list[str]):
-        for ds_id in datasource_ids:
-            if type(ds_id) != str:
-                raise ValueError(f"datasource_ids must be a list of string: {ds_id}")
+    def create(self, datasource_ids, **kwargs):
 
-        data = {"datasource_ids": datasource_ids}
+        # check datasource_ids
+        if any(not isinstance(ds_id, str) for ds_id in datasource_ids):
+            raise ValueError(f"datasource_ids must be a list of str: {datasource_ids}")
+        #
+        # if role_variables:
+        #     if not isinstance(role_variables, dict):
+        #         raise ValueError(f"role_variables must be a dict: {role_variables}")
+        #     if not role_id and not role_name:
+        #         raise ValueError("role_id or role_name must be provided if role_variables is provided")
+        #
+        data = {
+            "datasource_ids": datasource_ids,
+            **kwargs
+        }
         return self.api.send(endpoint=self.endpoint, method="POST", data=data)
```

## asktable/models/client_ds.py

```diff
@@ -1,40 +1,43 @@
 import os
 import time
 from asktable.log import log
 from atcommon.models import DataSourceCore, MetaData
-from asktable.models.client_chat import ChatList
+from asktable.models.client_chat import ChatList, MessageClientModel
 from asktable.models.client_base import convert_to_object, BaseResourceList
 from atcommon.exceptions.client import (
     DataSourceNotFound,
     UnsupportedFileType,
     DataSourceMetaProcessError,
     DataSourceMetaProcessTimeout
 )
 from asktable.upload import upload_to_oss
+from asktable.api import APIRequest
 
 
 class MetaDataClientModel(MetaData):
+    api: APIRequest
+    endpoint: str
 
     @property
     def status(self):
-        ds = self.api.send(endpoint=f"/datasources/{self.datasource_id}", method="GET")
+        ds = self.api.send(endpoint=f"{self.endpoint}/{self.datasource_id}", method="GET")
         return ds['meta_status']
 
     def get(self):
-        new_meta_dict = self.api.send(endpoint=f"/datasources/{self.datasource_id}/meta", method="GET")
+        new_meta_dict = self.api.send(endpoint=f"{self.endpoint}/{self.datasource_id}/meta", method="GET")
         self.update_from_dict(new_meta_dict)
         return self
 
     def delete(self):
-        self.api.send(endpoint=f"/datasources/{self.datasource_id}/meta", method="DELETE")
+        self.api.send(endpoint=f"{self.endpoint}/{self.datasource_id}/meta", method="DELETE")
         return True
 
     def update(self):
-        self.api.send(endpoint=f"/datasources/{self.datasource_id}/meta", method="POST")
+        self.api.send(endpoint=f"{self.endpoint}/{self.datasource_id}/meta", method="POST")
         return True
 
     def update_until_success(self, timeout=600):
         """
         同步元数据并轮询其状态，直到超时、成功或失败。
 
         参数:
@@ -81,42 +84,44 @@
             time.sleep(sleep_time)
 
             # 更新斐波那契数列的值
             fib_a, fib_b = fib_b, fib_a + fib_b
 
 
 class DataSourceClientModel(DataSourceCore):
+    api: APIRequest
+    endpoint: str
 
     def __init__(self, *args, **kwargs):
         super().__init__(*args, **kwargs)
         self.temp_chat = None  # 初始化时没有chat实例
 
     @property
     @convert_to_object(cls=MetaDataClientModel)
     def meta(self):
-        return self.api.send(endpoint=f"/datasources/{self.id}/meta", method="GET")
+        return self.api.send(endpoint=f"{self.endpoint}/{self.id}/meta", method="GET")
 
     @property
     @convert_to_object(cls=MetaDataClientModel)
     def meta_runtime(self):
         return self.api.send(
             endpoint=f"/datasources/{self.id}/meta",
             method="GET",
             params={"from_where": "runtime"}
         )
 
     def delete(self):
-        return self.api.send(endpoint=f"/datasources/{self.id}", method="DELETE")
+        return self.api.send(endpoint=f"{self.endpoint}/{self.id}", method="DELETE")
 
     @property
     def download_url(self):
-        resp = self.api.send(endpoint=f"/datasources/{self.id}/download_url", method="GET")
+        resp = self.api.send(endpoint=f"{self.endpoint}/{self.id}/download_url", method="GET")
         return resp.get('url')
 
-    def ask(self, question):
+    def ask(self, question) -> MessageClientModel:
         """
         使用临时chat实例提问。如果不存在，将创建一个新的chat实例并缓存起来。
 
         参数:
             question (str): 要提问的问题。
 
         返回:
@@ -140,36 +145,31 @@
         # 注意：这里需要提供正确的APIRequest实例给 ChatList
         chat_list = ChatList(self.api, "/chats")
         temp_chat = chat_list.create(datasource_ids=[self.id])
 
         return temp_chat
 
 
-class DataResourceList(BaseResourceList):
+class DataSourceList(BaseResourceList):
     __do_not_print_properties__ = ['tenant_id', 'access_config', 'sample_questions']
 
     @convert_to_object(cls=DataSourceClientModel)
     def _get_all_resources(self):
         return self._get_all_resources_request()
 
     @property
     @convert_to_object(cls=DataSourceClientModel)
     def latest(self):
-        # 获取最后一个资源
-        x = self._get_all_resources_request()
-        if x:
-            return x[0]
-        else:
-            return None
+        return self._get_latest_one_or_none()
 
     def page(self, page_number=1):
-        return DataResourceList(self.api, self.endpoint, page_number=page_number)
+        return DataSourceList(self.api, self.endpoint, page_number=page_number)
 
     def all(self):
-        return DataResourceList(self.api, self.endpoint, page_number=0, page_size=0)
+        return DataSourceList(self.api, self.endpoint, page_number=0, page_size=0)
 
     @convert_to_object(cls=DataSourceClientModel)
     def get(self, id=None, name=None):
         if id:
             return self.api.send(endpoint=f"{self.endpoint}/{id}", method="GET")
         elif name:
             response = self.api.send(endpoint=f"{self.endpoint}?name={name}", method="GET")
@@ -177,28 +177,27 @@
                 ds_list = response["data"]
                 return ds_list
             else:
                 raise DataSourceNotFound(f"Data Source {name} not found")
         else:
             raise ValueError("No ID or Name provided")
 
-
     @convert_to_object(cls=DataSourceClientModel)
-    def register(self, type, access_config, name=None, skip_process_meta=0):
+    def register(self, engine, access_config, name=None, skip_process_meta=0):
         data = {
-            "type": type, "name": name,
+            "engine": engine, "name": name,
             "access_config": access_config,
             "skip_process_meta": skip_process_meta
         }
         return self.api.send(endpoint=self.endpoint, method="POST",
                              data=data)
 
-    def register_until_success(self, type, access_config, name=None, timeout=600):
+    def register_until_success(self, engine, access_config, name=None, timeout=600):
         # 注册数据源并获取其ID
-        ds = self.register(type, access_config, name)
+        ds = self.register(engine, access_config, name)
         return self.wait_until_register_success(ds, timeout)
 
     def wait_until_register_success(self, datasource, timeout=600):
         start_time = time.time()
 
         # 初始化斐波那契数列间隔
         fib_a, fib_b = 1, 1
@@ -255,31 +254,31 @@
         if direct_to_oss:
             url = self.upload_file_to_oss(local_file_path)
         else:
             url = self.upload_file_to_server(local_file_path)
 
         if file_ext == '.csv':
             if until_success:
-                return self.register_until_success(type="csv", access_config={
+                return self.register_until_success(engine="csv", access_config={
                     "location_type": "http",
                     "location_url": url,
                 })
             else:
-                return self.register(type="csv", access_config={
+                return self.register(engine="csv", access_config={
                     "location_type": "http",
                     "location_url": url,
                 })
         elif file_ext in ['.xls', '.xlsx']:
             if until_success:
-                return self.register_until_success(type="excel", access_config={
+                return self.register_until_success(engine="excel", access_config={
                     "location_type": "http",
                     "location_url": url,
                 })
             else:
-                return self.register(type="excel", access_config={
+                return self.register(engine="excel", access_config={
                     "location_type": "http",
                     "location_url": url,
                 })
         else:
             raise UnsupportedFileType(f"File type {file_ext} not supported")
 
     # def signed_url(self, url):
```

## asktable/models/client_msg.py

```diff
@@ -3,28 +3,30 @@
 from atcommon.tools import format_time_ago
 from asktable.models.client_base import convert_to_object, BaseResourceList
 
 
 class MessageClientModel(MessageCore):
 
     @property
-    def answer(self):
+    def answer(self) -> BIAnswer or None:
+        # 废弃
         if self.role == 'ai':
             return BIAnswer.load_from_dict(self.content)
         else:
             return None
 
 
 class MessageList(BaseResourceList):
     __do_not_print_properties__ = ['chat_id']
 
     @convert_to_object(cls=MessageClientModel)
     def _get_all_resources(self):
         # 获取所有资源
-        msgs = self.api.send(endpoint=self.endpoint, method="GET")
+        msgs = self._get_all_resources_request()
+
         for m in msgs:
             m['created'] = format_time_ago(m['created'])
             if m['role'] == 'ai':
                 answer = BIAnswer.load_from_dict(m['content'])
                 m['content'] = answer
         return msgs
```

## asktable/models/client_securetunnel.py

```diff
@@ -1,44 +1,52 @@
 
 from asktable.models.client_base import convert_to_object, BaseResourceList
 from atcommon.models.securetunnel import SecureTunnelCore, SecureTunnelLinkCore
-
+from asktable.api import APIRequest
 
 
 class SecureTunnelLinkList(BaseResourceList):
     __do_not_print_properties__ = ['created_at']
 
     @convert_to_object(cls=SecureTunnelLinkCore)
     def _get_all_resources(self):
         return self._get_all_resources_request()
 
 
 class SecureTunnel(SecureTunnelCore):
+    api: APIRequest
+    endpoint: str
+
     def delete(self):
-        return self.api.send(endpoint=f"/securetunnels/{self.id}", method="DELETE")
+        return self.api.send(endpoint=f"{self.endpoint}/{self.id}", method="DELETE")
 
     def update(self, name, client_info):
         return self.api.send(
             endpoint=f"/securetunnels/{self.id}",
             method="POST",
             data={"atst_name": name, "client_info": client_info}
         )
 
     @property
     def links(self):
-        return SecureTunnelLinkList(self.api, endpoint=f"/securetunnels/{self.id}/links")
+        return SecureTunnelLinkList(self.api, endpoint=f"{self.endpoint}/{self.id}/links")
 
 
 class SecureTunnelList(BaseResourceList):
     __do_not_print_properties__ = ['tenant_id', 'created_at', 'info']
 
     @convert_to_object(cls=SecureTunnel)
     def create(self):
         return self.api.send(endpoint=self.endpoint, method="POST")
 
     @convert_to_object(cls=SecureTunnel)
     def _get_all_resources(self):
         return self._get_all_resources_request()
 
+    @property
+    @convert_to_object(cls=SecureTunnel)
+    def latest(self):
+        return self._get_latest_one_or_none()
+
     @convert_to_object(cls=SecureTunnel)
     def get(self, id):
         return self.api.send(endpoint=f"{self.endpoint}/{id}", method="GET")
```

## atcommon/tools.py

```diff
@@ -1,17 +1,19 @@
 import uuid
 import base62
 import time
 from datetime import datetime
 
 
-def format_time_ago(unix_timestamp) -> str:
+def format_time_ago(unix_timestamp: int) -> str:
     """
     Convert a Unix timestamp to a user-friendly time string.
     """
+    if not unix_timestamp:
+        return ''
     try:
         unix_timestamp = int(unix_timestamp)
     except:
         return unix_timestamp
 
     now = int(time.time())
     unix_timestamp = int(unix_timestamp)
@@ -41,19 +43,22 @@
     markdown = ""
     if isinstance(d, dict):
         for key, value in d.items():
             # print(f"key: {key}, value: {value}, type: {type(value)}")
             if key in table_format_keys and value:
                 # 特殊处理fields为表格，动态获取列名
                 headers = value[0].keys()  # 从第一个元素获取所有键作为表头
-                markdown += f"{'  ' * indent}* **{key}**: \n\n"
+                markdown += f"{'  ' * indent}* **{key}**: \n"
                 markdown += f"{'  ' * indent}" + " | ".join(headers) + "\n"
                 markdown += f"{'  ' * indent}" + " | ".join(["---"]*len(headers)) + "\n"
                 for field in value:
                     markdown += f"{'  ' * indent}" + " | ".join([str(field[h]) for h in headers]) + "\n"
+
+                markdown += "\n" + f"{'  ' * indent}-----\n\n"  # 分割线和空行
+
             else:
                 markdown += f"{'  ' * indent}* **{key}**: "
                 if isinstance(value, (dict, list)):
                     markdown += "\n" + dict_to_markdown(value, indent+1, table_format_keys=table_format_keys)
                 else:
                     markdown += f"{value}\n"
     elif isinstance(d, list):
@@ -98,14 +103,15 @@
 def gen_id_for_msg():
     return f"msg_{gen_base62_uuid()}"
 
 
 def gen_id_for_run():
     return f"run_{gen_base62_uuid()}"
 
+
 def ctime_chn():
     # 获取当前时间
     now = datetime.now()
     # 注意：中文日期时间格式可以根据需要进行调整
     chinese_weekday = ['星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期日']
     # 获取星期几的数字（0-6），然后将其转换为中文名称
     weekday_cn = chinese_weekday[now.weekday()]
```

## atcommon/version.py

```diff
@@ -1 +1 @@
-VERSION="0.14.3"
+VERSION="0.17.0"
```

## atcommon/exceptions/server_base.py

```diff
@@ -38,72 +38,113 @@
 
 class Unauthorized(ManagementError):
     code = 1000
     message = "Unauthorized"
 
 
 class DataSourceExists(ManagementError):
-    code = 1001
+    code = 10011
     message = "Datasource already exists"
 
 
+class AuthRolePolicyExists(ManagementError):
+    code = 10112
+    message = "Auth Role Policy already exists"
+
+
 class DataSourceNotFound(ManagementError):
-    code = 1002
+    code = 10041
     message = "Datasource not found"
 
 
 class ChatNotFound(ManagementError):
-    code = 1003
+    code = 10042
     message = "Chat not found"
 
 
+class MessageNotFound(ManagementError):
+    code = 10043
+    message = "Message not found"
+
+
+class TenantNotFound(ManagementError):
+    code = 10044
+    message = "Tenant not found"
+
+
+class SecureTunnelNotFound(ManagementError):
+    code = 10045
+    message = "SecureTunnel not found"
+
+
+class SecureTunnelLinkNotFound(ManagementError):
+    code = 10046
+    message = "SecureTunnel link not found"
+
+
+class AuthPolicyNotFound(ManagementError):
+    code = 10047
+    message = "Auth Policy not found"
+
+
+class AuthRoleNotFound(ManagementError):
+    code = 10048
+    message = "Auth Role not found"
+
+
 class ParameterError(ManagementError):
-    code = 1004
+    code = 1003
     message = "Parameter error"
 
 
 class DataSourceConfigError(ManagementError):
     code = 1005
     message = "Datasource config error"
 
 
-class TenantNotFound(ManagementError):
-    code = 1006
-    message = "Tenant not found"
-
-
 class DataSourceMetaProcessing(ManagementError):
     code = 1007
     message = "Datasource meta processing"
 
 
 class DataSourceMetaNotReady(ManagementError):
     code = 1008
     message = "Datasource meta not ready!"
 
 
-class SecureTunnelNotFound(ManagementError):
-    code = 1009
-    message = "SecureTunnel not found"
-
-
-class SecureTunnelLinkNotFound(ManagementError):
-    code = 1010
-    message = "SecureTunnel link not found"
-
-
 class SecureTunnelInUse(ManagementError):
     code = 1011
     message = "SecureTunnel in use"
 
 
 class ATSTServerAPIError(ManagementError):
     code = 1012
     message = "ATST Server API error"
 
+
+class AuthPolicyConfigError(ManagementError):
+    code = 1013
+    message = "Auth Policy config error"
+
+
+class AuthRoleConfigError(ManagementError):
+    code = 1015
+    message = "Auth Role config error"
+
+
+class AuthRoleVariablesError(ManagementError):
+    code = 1018
+    message = "Auth Role variables error"
+
+
+class AuthRolePrivilegesError(ManagementError):
+    code = 1019
+    message = "Auth Role privileges error"
+
+
 ################################
 
 
 class QAErrorNoMatchDataSource(QAError):
     code = 2002
     message = "No match datasource"
 
@@ -124,28 +165,54 @@
 
 
 class QAErrorNoColumnFound(QAError):
     code = 2006
     message = "No column found"
 
 
+class QueryPermissionDenied(QAError):
+    code = 2008
+    message = "Permission denied"
+
+
+class NoDataFound(QAError):
+    code = 2009
+    message = "No data found"
+
 ####################################
 
 
 class PromptTooLong(InternalError):
     code = 3001
     message = "Prompt too long"
 
 
 class InvalidStrucQuery(InternalError):
     code = 3002
     message = "Invalid query syntax"
 
 
-class LLMServiceError(InternalError):
-    code = 3003
-    message = "LLM service error"
+######################################
+class LLMError(InternalError):
+    code = 30031
+    message = "LLM error"
+
+class LLMBadRequest(LLMError):
+    code = 30032
+    message = "LLM bad request"
+
+class LLMConnectionError(LLMError):
+    code = 30033
+    message = "LLM connection error"
+
+
+############ DataSourceError  ################
+
+class RetrieveMetaError(DataSourceError):
+    code = 5001
+    message = "Retrieve meta error"
+
 
+class QueryDataError(DataSourceError):
+    code = 5002
+    message = "Query data error"
 
-class LLMRequestError(InternalError):
-    code = 3004
-    message = "LLM request error"
```

## atcommon/exceptions/server_plugins.py

```diff
@@ -18,12 +18,7 @@
     code = 10054
     message = "文件扩展名不合法"
 
 
 class ExcelProcessError(ServerBaseError):
     code = 10055
     message = "Excel处理错误"
-
-
-class MySQLRetrieveMetaError(DataSourceError):
-    code = 10056
-    message = "MySQL元数据获取失败"
```

## atcommon/models/__init__.py

```diff
@@ -1,11 +1,14 @@
 from atcommon.models.datasource import DataSourceCore
 from atcommon.models.meta import MetaData, DataField, DataTable, DataSchema
 from atcommon.models.chat import ChatCore, MessageCore, RunCore
-from atcommon.models.bi import StrucQuery, QueryResult, BIAnswer, UserQuestion, Question
+from atcommon.models.qa import StrucQuery, QueryResult, BIAnswer, UserQuestion, Question
+from atcommon.models.securetunnel import SecureTunnelCore, SecureTunnelLinkCore
+from atcommon.models.auth import AuthRoleCore, AuthPolicyCore
+
 
 __all__ = [
     'MetaData',
     'DataField',
     'DataTable',
     'DataSchema',
     'DataSourceCore',
@@ -13,8 +16,12 @@
     'MessageCore',
     'RunCore',
     'StrucQuery',
     'QueryResult',
     'BIAnswer',
     'UserQuestion',
     'Question',
+    'SecureTunnelCore',
+    'SecureTunnelLinkCore',
+    'AuthRoleCore',
+    'AuthPolicyCore',
 ]
```

## atcommon/models/base.py

```diff
@@ -21,7 +21,20 @@
             # 检查属性是否为 datetime 实例
             if isinstance(value, datetime):
                 # 将 datetime 转换为 ISO 格式的字符串
                 data[k] = value.isoformat()
             else:
                 data[k] = value
         return data
+
+    @classmethod
+    def load_from_model(cls, model_obj):
+        if not model_obj:
+            return None
+
+        data = {}
+        for k in cls.__properties_init__:
+            if hasattr(model_obj, k):
+                data[k] = getattr(model_obj, k)
+            else:
+                data[k] = None
+        return cls(**data)
```

## atcommon/models/chat.py

```diff
@@ -1,29 +1,47 @@
 from atcommon.models.base import BaseCoreModel
 from atcommon.tools import format_time_ago
-from atcommon.models.bi import BIAnswer
+from atcommon.models.qa import BIAnswer
+
 
 class ChatCore(BaseCoreModel):
-    __properties_init__ = ['tenant_id', 'id', 'datasource_ids', 'human_msgs', 'ai_msgs', 'created', 'latest_msg']
+    id: str
+    tenant_id: str
+    datasource_ids: list[str]
+    role_id: str
+    role_variables: dict
+    created: int
+
+    __properties_init__ = ['tenant_id', 'id', 'datasource_ids', 'human_msgs', 'ai_msgs',
+                           'created', 'latest_msg', 'role_id', 'role_variables']
 
     def __repr__(self):
-        return f"<Chat {self.id} [{format_time_ago(self.created)}]>"
+        return f"<Chat[{self.role_id}] {self.id} [{format_time_ago(self.created)}]>"
 
 
 class MessageCore(BaseCoreModel):
+    id: str
+    chat_id: str
+    role: str
+    content: dict
+    reply_to_msg_id: str
+    created: int
 
     # role: human | ai
     __properties_init__ = ['id', 'chat_id', 'created', 'role', 'content', 'reply_to_msg_id']
 
     def __repr__(self):
         if self.role == 'ai':
-            return f"[{self.id}] [{self.role}] {BIAnswer.load_from_dict(self.content)} [{format_time_ago(self.created)}]>"
+            return f"[{self.id}] [{self.role}] {BIAnswer.load_from_dict(self.content)}"
         else:
-            return f"[{self.id}] [{self.role}] {self.content} [{format_time_ago(self.created)}]>"
+            return f"[{self.id}] [{self.role}] {self.content}"
 
 
 class RunCore(BaseCoreModel):
+    id: str
+    chat_id: str
+
     # status: running | finished | failed | canceled
     __properties_init__ = ['id', 'chat_id', 'created', 'status', 'steps']
 
     def __repr__(self):
         return f"<ChatRun {self.id} [{format_time_ago(self.created)}]>"
```

## atcommon/models/datasource.py

```diff
@@ -1,22 +1,30 @@
 # 通用的数据源类，提供了各种数据源均需要的基本属性和方法，比如Original MetaData以及获取MetaData的方法
 from atcommon.models.base import BaseCoreModel
 
 
 class DataSourceCore(BaseCoreModel):
+    tenant_id: str
+    id: str
+    name: str
+    engine: str
+    access_config: dict
+    sample_questions: str
+    meta_status: str
+    meta_error: str
 
     __properties_init__ = ['tenant_id', 'id', 'created_at',
-                           'name', 'type', 'access_config',
-                           'sample_questions', 'meta_status']
+                           'name', 'engine', 'access_config',
+                           'sample_questions', 'meta_status', 'meta_error']
 
     def __repr__(self):
         if self.id:
             return f"<{self.id}>"
         else:
-            return f"<{self.type} (not saved)>"
+            return f"<{self.engine} (not saved)>"
 
     def __str__(self):
         return self.__repr__()
 
     @property
     def safe_access_config(self):
         # 复制access_config以避免修改原始数据
```

## atcommon/models/meta.py

```diff
@@ -1,7 +1,8 @@
+import re
 from typing import Dict, List, Optional
 from copy import deepcopy
 from functools import wraps
 import json
 from tabulate import tabulate
 from atcommon.tools import dict_to_markdown
 
@@ -123,14 +124,18 @@
         self.fields = []
         self.fields_dict: Dict[str, DataField] = {}
 
     def add_field(self, field: DataField):
         self.fields.append(field)
         self.fields_dict[field.name] = field
 
+    def remove_field(self, field_name: str):
+        field = self.fields_dict.pop(field_name)
+        self.fields.remove(field)
+
     def get_field(self, field_name):
         return self.fields_dict.get(field_name)
 
     def __repr__(self):
         return f"<DataTable(name='{self.full_name}', curr_desc='{self.curr_desc}')>"
 
     def to_dict(self, level='field', includes=(), excludes=()):
@@ -176,14 +181,18 @@
         self.tables = []
         self.tables_dict: Dict[str, DataTable] = {}
 
     def add_table(self, table: DataTable):
         self.tables.append(table)
         self.tables_dict[table.name] = table
 
+    def remove_table(self, table_name: str):
+        table = self.tables_dict.pop(table_name)
+        self.tables.remove(table)
+
     def get_table(self, table_name):
         return self.tables_dict.get(table_name)
 
     @property
     def custom_configs_dict(self):
         if not self.custom_configs:
             return {}
@@ -229,24 +238,34 @@
     #             'tables': need_infer_tables
     #         }
     #     else:
     #         return {}
 
 
 class MetaData(DataBaseObject):
+
+    STATUS_PROCESSING = 'processing'
+    STATUS_FAILED = 'failed'
+    STATUS_SUCCESS = 'success'
+    STATUS_UNPROCESSED = 'unprocessed'
+
     def __init__(self, name, datasource_id=''):
         self.name = name
         self.datasource_id = datasource_id
         self.schemas = []
         self.schemas_dict: Dict[str, DataSchema] = {}
 
     def add_schema(self, schema: DataSchema):
         self.schemas.append(schema)
         self.schemas_dict[schema.name] = schema
 
+    def remove_schema(self, schema_name: str):
+        schema = self.schemas_dict.pop(schema_name)
+        self.schemas.remove(schema)
+
     def get_schema(self, schema_name):
         return self.schemas_dict.get(schema_name)
 
     def filter_for_process(self) -> "MetaData":
         """
         返回一个新的 MetaData 对象，其中只包含需要分析的字段。
         """
@@ -434,15 +453,15 @@
             'schemas': [schema.to_dict(level, includes=includes, excludes=excludes)
                         for schema in self.schemas]
         }
 
     def to_dict_for_prompt(self):
         result = {
             'name': self.name,
-            'datasource_id': self.datasource_id,
+            # 'datasource_id': self.datasource_id,
             'schemas': [schema.to_dict(
                 level='field',
                 includes=(
                     'name',
                     'full_name',
                     'curr_desc',
                 )) for schema in self.schemas]
@@ -516,16 +535,16 @@
                     "name": [schema_name],
                     "curr_desc": [schema_curr_desc],
                     "tables": [
                         {
                             "name": [table_name],
                             "curr_desc": [table_curr_desc],
                             "fields": [
-                                ["filed_name_1", "filed_curr_desc_1"],
-                                ["filed_name_2", "filed_curr_desc_2"],
+                                ["field_name_1", "filed_curr_desc_1"],
+                                ["field_name_2", "filed_curr_desc_2"],
                             ]
                         },
                     ]
                 }
             ]
         }
         """
@@ -685,21 +704,201 @@
                     filtered_schema = filtered_metadata.get_schema(schema_name)
                     if not filtered_schema:
                         # 如果不存在，则复制 schema 到新的 MetaData 实例中
                         filtered_schema = DataSchema(
                             name=schema.name,
                             metadata=filtered_metadata,
                             origin_desc=schema.origin_desc,
-                            curr_desc=schema.curr_desc,
+                            curr_desc='',  # 因为过滤了部分meta，所以curr_desc置空
                             curr_desc_stat=schema.curr_desc_stat,
                             custom_configs=schema.custom_configs
                         )
                         filtered_metadata.add_schema(filtered_schema)
 
                     # 然后复制 table 到新的 schema 中
                     cloned_table = deepcopy(table)
                     # 更新 cloned_table 的 schema 属性为新的 schema
                     cloned_table.schema = filtered_schema
                     filtered_schema.add_table(cloned_table)
 
         return filtered_metadata
 
+    def get_schema_names(self, pattern=None) -> List[str]:
+        """
+        Return a list of schema names that match the given pattern.
+        """
+        if pattern:
+            regex = re.compile(pattern)
+            return [schema.name for schema in self.schemas if regex.match(schema.name)]
+        return [schema.name for schema in self.schemas]
+
+    def get_table_names(self, schema_pattern=None, table_pattern=None):
+        table_names = []
+        schema_regex = re.compile(schema_pattern) if schema_pattern else None
+        table_regex = re.compile(table_pattern) if table_pattern else None
+        for schema in self.schemas:
+            if not schema_pattern or schema_regex.match(schema.name):
+                for table in schema.tables:
+                    if not table_pattern or table_regex.match(table.name):
+                        table_names.append(f"{schema.name}.{table.name}")
+        return table_names
+
+    def get_field_names(self, schema_pattern=None, table_pattern=None, field_pattern=None) -> dict[str, List[str]]:
+        """
+        Return a dictionary of field names, where the key is the table name and the value is a list of field names.
+        """
+        field_names = {}
+        schema_regex = re.compile(schema_pattern) if schema_pattern else None
+        table_regex = re.compile(table_pattern) if table_pattern else None
+        field_regex = re.compile(field_pattern) if field_pattern else None
+        for schema in self.schemas:
+            if not schema_pattern or schema_regex.match(schema.name):
+                for table in schema.tables:
+                    if not table_pattern or table_regex.match(table.name):
+                        fields_in_table = []
+                        for field in table.fields:
+                            if not field_pattern or field_regex.match(field.name):
+                                fields_in_table.append(f"{schema.name}.{table.name}.{field.name}")
+                        field_names[f"{schema.name}.{table.name}"] = fields_in_table
+        return field_names
+
+    def filter_by_regex(self, schema_pattern=None, table_pattern=None, field_pattern=None) -> "MetaData":
+        """
+        Filter the metadata by regular expressions and return a new MetaData instance containing only the matching items.
+        if a pattern is None, it will not be used for filtering, so all items will be included.
+        """
+        filtered_metadata = MetaData(name=f"{self.name}_regex_filtered", datasource_id=self.datasource_id)
+
+        # 预编译正则表达式
+        schema_regex = re.compile(schema_pattern) if schema_pattern else None
+        table_regex = re.compile(table_pattern) if table_pattern else None
+        field_regex = re.compile(field_pattern) if field_pattern else None
+
+        # 遍历所有schemas
+        for schema in self.schemas:
+            # 检查schema是否匹配
+            if schema_regex and not schema_regex.match(schema.name):
+                continue  # 如果schema不匹配，则跳过当前schema
+
+            # 创建一个新的schema对象
+            new_schema = DataSchema(
+                name=schema.name,
+                metadata=filtered_metadata,
+                origin_desc=schema.origin_desc,
+                curr_desc='',  # 因为过滤了部分meta，所以curr_desc置空
+                curr_desc_stat=schema.curr_desc_stat,
+                custom_configs=schema.custom_configs
+            )
+            schema_added = False
+
+            # 遍历所有tables
+            for table in schema.tables:
+                # 检查table是否匹配
+                if table_regex and not table_regex.match(table.name):
+                    continue  # 如果table不匹配，跳过当前table
+
+                # 创建一个新的table对象
+                new_table = DataTable(
+                    name=table.name,
+                    schema=new_schema,
+                    origin_desc=table.origin_desc,
+                    curr_desc=table.curr_desc,
+                    curr_desc_stat=table.curr_desc_stat
+                )
+                table_added = False
+
+                # 遍历所有fields
+                for field in table.fields:
+                    # 检查field是否匹配
+                    if field_regex and not field_regex.match(field.name):
+                        continue  # 如果field不匹配，跳过当前field
+
+                    # 添加匹配的field到new_table
+                    new_field = deepcopy(field)
+                    new_field.table = new_table
+                    new_table.add_field(new_field)
+                    table_added = True
+
+                # 如果new_table添加了至少一个field，将其加入到new_schema
+                if table_added:
+                    new_schema.add_table(new_table)
+                    schema_added = True
+
+            # 如果new_schema添加了至少一个table，将其加入到filtered_metadata
+            if schema_added:
+                filtered_metadata.add_schema(new_schema)
+
+        return filtered_metadata
+
+
+def merge_metas(allow_metas: list[MetaData], deny_metas: list[MetaData]) -> MetaData:
+    # 创建一个新的 MetaData 实例作为结果
+    result_meta = MetaData(name="MergedMetaData")
+
+    # 先合并所有允许的 meta
+    for allow_meta in allow_metas:
+        for schema in allow_meta.schemas:
+            result_schema = result_meta.get_schema(schema.name)
+            if not result_schema:
+                # 如果结果 meta 中还没有这个 schema，复制它
+                result_schema = DataSchema(
+                    name=schema.name,
+                    metadata=result_meta,
+                    origin_desc=schema.origin_desc,
+                    curr_desc=schema.curr_desc,
+                    curr_desc_stat=schema.curr_desc_stat,
+                    custom_configs=schema.custom_configs
+                )
+                result_meta.add_schema(result_schema)
+
+            for table in schema.tables:
+                result_table = result_schema.get_table(table.name)
+                if not result_table:
+                    # 如果结果 schema 中还没有这个 table，复制它
+                    result_table = DataTable(
+                        name=table.name,
+                        schema=result_schema,
+                        origin_desc=table.origin_desc,
+                        curr_desc=table.curr_desc,
+                        curr_desc_stat=table.curr_desc_stat
+                    )
+                    result_schema.add_table(result_table)
+
+                for field in table.fields:
+                    # 检查这个 field 是否已经在结果 table 中
+                    result_field = result_table.get_field(field.name)
+                    if not result_field:
+                        # 如果不在，复制它
+                        new_field = DataField(
+                            name=field.name,
+                            table=result_table,
+                            origin_desc=field.origin_desc,
+                            curr_desc=field.curr_desc,
+                            curr_desc_stat=field.curr_desc_stat,
+                            related_field=field.related_field,
+                            related_field_precision_rate=field.related_field_precision_rate,
+                            sample_data=field.sample_data
+                        )
+                        result_table.add_field(new_field)
+
+    # 然后剔除所有禁止的 meta
+    for deny_meta in deny_metas:
+        for schema in deny_meta.schemas:
+            for table in schema.tables:
+                for field in table.fields:
+                    # 尝试找到并移除 field
+                    full_field_name = f"{schema.name}.{table.name}.{field.name}"
+                    field_to_remove = result_meta.get_field_by_full_name(full_field_name)
+                    if field_to_remove:
+                        # field_to_remove.table.fields.remove(field_to_remove)
+                        field_to_remove.table.remove_field(field_to_remove.name)
+                        # 如果 table 中没有 field 了，也移除 table
+                        if not field_to_remove.table.fields:
+                            # field_to_remove.table.schema.tables.remove(field_to_remove.table)
+                            field_to_remove.table.schema.remove_table(field_to_remove.table.name)
+                            # 如果 schema 中没有 table 了，也移除 schema
+                            if not field_to_remove.table.schema.tables:
+                                # result_meta.schemas.remove(field_to_remove.table.schema)
+                                result_meta.remove_schema(field_to_remove.table.schema.name)
+
+    return result_meta
+
```

## atcommon/models/securetunnel.py

```diff
@@ -1,20 +1,38 @@
 from atcommon.models.base import BaseCoreModel
 
 
 class SecureTunnelCore(BaseCoreModel):
+    tenant_id: str
+    id: str
+    name: str
+    atst_server_host: str
+    atst_server_port: int
+    links_count: int
+    status: str
+
     __properties_init__ = ['tenant_id', 'id', 'name', 'atst_server_host', 'atst_server_port',
                            'links_count', 'status', 'created_at', 'modified_at', 'info']
 
     def __repr__(self):
         return f"<ATST {self.id}>"
 
 
 class SecureTunnelLinkCore(BaseCoreModel):
+    securetunnel_id: str
+    id: str
+    created_at: str
+    modified_at: str
+    target_host: str
+    target_port: int
+    proxy_port: int
+    status: str
+    datasource_ids: list
+
     # remove proxy_host because it is configured in configfile
     __properties_init__ = ['securetunnel_id', 'id', 'created_at',
                            'modified_at', 'target_host', 'target_port',
                            'proxy_port', 'status', 'datasource_ids',]
 
     def __repr__(self):
         return (f"<STLink {self.id}({self.securetunnel_id}) [proxy]:{self.proxy_port}->"
-                f"{self.target_host}:{self.target_port}>")
+                f"{self.target_host}:{self.target_port}>")
```

## Comparing `atcommon/models/bi.py` & `atcommon/models/qa.py`

 * *Files 3% similar despite different names*

```diff
@@ -80,29 +80,37 @@
 
     @property
     def column_count(self):
         return len(self.columns)
 
 
 class BIAnswer(BaseCoreModel):
+    status: str
+    elapsed_time: int
+    text: str
+    files: list | None
+    charts: list | None
+    query_insights: list | None
+    payload: dict | None
+
     __properties_init__ = [
         'status',
         'elapsed_time',
-        'answer_text',
+        'text',
         'files',
         'charts',
         'query_insights',  # Transparency Reports
         'payload',
 
     ]
 
     def __str__(self):
         file_str = f"[File:{[f.get('url') for f in self.files]}]" if self.files else ''
         image_str = f"[Image:{[c.get('url') for c in self.charts]}]" if self.charts else ''
-        return f"[{self.status}-{self.elapsed_time}s] {self.answer_text} {file_str} {image_str}"
+        return f"[{self.status}-{self.elapsed_time}s] {self.text} {file_str} {image_str}"
 
     def __repr__(self):
         return self.__str__()
 
     def query_insights_to_string(self):
         """
         将query_insights转换为字符串
```

## Comparing `asktable-0.14.3.dist-info/METADATA` & `asktable-0.17.0.dist-info/METADATA`

 * *Files 27% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: asktable
-Version: 0.14.3
+Version: 0.17.0
 Summary: AskTable SDK
 Home-page: https://asktable.com/
 Author: lele
 Description-Content-Type: text/markdown
 Requires-Dist: requests
 Requires-Dist: tabulate
 Requires-Dist: pybase62
@@ -25,15 +25,15 @@
 依赖 Python 3.9+。
 
 ```shell
 pip install asktable
 ```
 
 
-## 4 使用方式
+## 4 快速开始
 
    - **命令行CLI**
        ```shell
        $ pip install asktable
        $ asktable -t <token>
     
        -- AskTable 客户端(0.7.19)初始化完成！
@@ -52,15 +52,15 @@
     ```python
     from asktable import AskTable 
     at = AskTable(token='your_token')
     ds = at.datasources.create_from_local_file("your_excel_file_path")
     ds.ask('总共有多少行？')
     ```
 
-## 5 使用示例
+## 5 完整示例
 
 以下示例使用命令行CLI方式演示。
 
 ### 5.1 注册数据源
 
 1. 注册 MySQL 数据源
 
@@ -99,15 +99,15 @@
 
 3. 上传并注册一个本地的文件（Excel或CSV）
     ```python
     In [69]: at.datasources.create_from_local_file(local_file_path="/DataMini/asktable/sample_data/tests/test_chart.xlsx", direct_to_oss=True)
     Out[69]: <ds_mrQq88Pu2DaBLCUZwgBAO: 月销售数据 >
     ```
 
-### 5.2 查找数据源
+### 5.2 查看和使用数据源
 
 1. 所有数据源
     ```python
     In [54]: at.datasources
     Out[54]: 
     id                         created_at           name                                     type
     ds_1MEd5IA392sgt7mw5PcwgV  2024-01-21T17:09:18  高校讲师工作量汇总                       excel
@@ -137,15 +137,24 @@
     In [57]: at.datasources.get(name='杭州房产信息')
     Out[57]: 
     [<ds_25vqFPq3wAgzcCVGoygBOO: 杭州房产信息 >,
      <ds_2eGWHUvUbWN0AAbke0aKIb: 杭州房产信息 >,
      <ds_2TDFez0l0qiSwFLsGvRKvV: 杭州房产信息 >]
     ```
 
-### 5.3 管理数据源
+5. 删除数据源
+
+    ```python 
+    In [65]: ds = at.datasources.latest.delete()  # 删除最新的数据源
+    Out[65]: True
+    ```
+   同时会删除这个数据源对应的 AskTable SecureTunnel Link（ATST Link）。
+
+
+### 5.3 查看和管理数据源的Meta信息
 
 1. 查看Meta（在AskTable中管理的Meta）
     ```python
     In [15]: at.datasources.latest.meta
     Out[15]: 
     test (测试环境数据库)
     ------------------------------
@@ -196,26 +205,19 @@
 6. 查看示例问题
     ```python
     In [62]: ds = at.datasources.latest
     
     In [63]: ds.sample_questions
     Out[63]: '- 查询杭州房产的平均总价\n- 统计各区域房产数量 \n（为了方便沟通，您可以直接指定列名：城市, 区域, 子区域, 小区, 总价, 单价, 户型, 楼层, 建筑面积, 套内面积, 装修, 梯户比例, 电梯, 别墅类型, 挂牌日期, 产权, 房屋用途, 房龄, 链接）'
     ```
-   
-7. 删除数据源
 
-    ```python 
-    In [65]: ds = at.datasources.latest.delete()  # 删除最新的数据源
-    Out[65]: True
-    ```
-   同时会删除这个数据源对应的 AskTable SecureTunnel Link（ATST Link）。
 
-### 5.4 开始对话
+### 5.4 发起和管理对话
 
-1. 快速提问
+1. 基于一个数据源，发起会话并提问
     ```python
     In [8]: answer = at.datasources.latest.ask('你好')
     Out[8]: [msg_5PvPIvwPofYG9HkUzjzzRc] [ai] [OK-10s] 你好！有什么可以帮助你的吗？   [Just now]>
     ```
 
 2. 选择多个数据源，一起提问
     ```python
@@ -227,89 +229,90 @@
     Out[11]: 
     {'id': 'msg_4wQf4lD2AqDiPikRW4Tijk',
      'chat_id': 'chat_G5g0FKbGQlljAKHrKz160',
      'created': 1712287283,
      'role': 'ai',
      'content': {'status': 'OK',
       'elapsed_time': 2,
-      'answer_text': '你好！有什么可以帮到您的吗？',
+      'text': '你好！有什么可以帮到您的吗？',
       'answer_file_url': None,
       'answer_image_url': None,
       'structure_queries': None,
       'statistics': None},
      'reply_to_msg_id': 'msg_7aEuVCH8fX9BzlS3EvwKnl'}
     ```
-   
-### 5.5 查看对话
 
-1. 查看所有对话
+3. 查看所有对话
     ```python
     In [40]: at.chats
     Out[40]: 
     id                           created              datasource_ids                   human_msgs    ai_msgs  latest_msg
     chat_E90pdsNUlDE7wo8gsjahf   2024-01-06 12:10:00  ['ds_1ZAoAyIn1ph0lldief4cP5']             2          2  2024-01-07 01:26:48
     chat_ql7vWZEIqafqg9dMAaNpi   2024-01-07 05:35:03  ['ds_S0tdSsWcuB2HxEA1BQICE']              0          0
     chat_1SfzrRkiIlKyvHtOTbX7qW  2024-01-07 05:46:21  ['ds_6tWxUjnKbK2JwJRmLuPTj9']             4          4  2024-01-07 05:50:59
     chat_2WEHFozMZPFQhYkqLwvufZ  2024-01-07 10:34:15  ['ds_5Jydks0MbCJ3atBIHBC98']              1          1  2024-01-07 10:35:02
     ```
-2. 获取最后一个对话
+4. 获取最后一个对话
     ```python
     In [41]: at.chats.latest
     Out[41]: <Chat chat_6LYoQImReUun8gR8q32LZm [2024-02-06 06:33:47]>
     ```
-3. 根据ID查找对话
+
+5. 根据ID查找对话
     ```python
     In [44]: at.chats.get('chat_1SfzrRkiIlKyvHtOTbX7qW')
     Out[44]: <Chat chat_1SfzrRkiIlKyvHtOTbX7qW [2024-01-07 05:46:21]>
     ```
    
-4. 查看某个对话的历史消息
+6. 查看某个对话的历史消息
+
     ```python
     In [43]: at.chats.latest.messages
     Out[43]: 
     id                          created                 role    content
     msg_1x0t6ch4KzZiSPFDbrL1iC  2 hours 59 minutes ago  human   将B列的数据拆分为姓名、手机号和地址三列
     msg_5D5bdJ2vBYjhpjlVuqyN5N  2 hours 59 minutes ago  ai      [OK-22s] 很抱歉，由于元数据中并未提供包含电话号码和地址的字段信息，我们无法直接从数据库中分割列B的数据为姓名、电话号码和地址三个独立的列。如果您能提供更详细的数据格式或者具体的分割规则，我们可能会有其他方式来帮助您处理这个问题。
     msg_1rnZp94PzQeMetZxV2W3VC  2 hours 57 minutes ago  human   看起来好像可以按照换行来拆分
     msg_1igXXP1VBMSVx2iW8DENVt  2 hours 57 minutes ago  ai      [OK-34s] 已经根据您的要求将B列的数据拆分为姓名、手机号和地址三列。您可以查看处理好的数据。 [File:https://0vc.cc/KcZzK]
     ```
 
-### 5.6 删除对话
-
-删除某个对话
+7. 删除某个对话
 
     ```python
     In [45]: chat = at.chats.latest
     
     In [46]: chat.delete()
     Out[46]: True
     ```
 
-### 5.7 安全隧道 AskTable Secure Tunnel(ATST)
-
-
-1. 创建 ATST，申请一个Key
+### 5.5 AskTable Secure Tunnel (ATST) 安全隧道
+AskTable Secure Tunnel (ATST) 是一种安全工具，允许 AskTable 服务通过安全隧道与内部本地数据库进行安全通信。此服务适用于需要确保数据传输安全性的企业环境。
 
-用于创建一个新的 AskTable Secure Tunnel (ATST)，并返回一个唯一的 `securetunnel_id`。
+1. 启动一个新的 AskTable Secure Tunnel 之前，需要获得一个唯一的 `securetunnel_id`。
 
-```python
-    In [1]: atst = at.securetunnels.create()
-    Out[1]: <SecureTunnel: atst_p94PzQeMetZxV2W3VC>
-```
-
-2. 查看所有的 ATST
-```python
-    In [2]: at.securetunnels
-    Out[2]: 
-    key                         created_at           
-    atst_p94PzQeMetZxV2W3VC    2024-01-06 12:10:00  
-    atst_p94PzQeMetZxV2W3VC    2024-01-07 05:35:03  
-    atst_p94PzQeMetZxV2W3VC  2024-01-07 05:46:21  
-    atst_p94PzQeMetZxV2W3VC  2024-01-07 10:34:15
-```
+   ```python
+   from asktable import AskTable
+   at = AskTable(token='your_token')
+   
+   # 创建新的安全隧道Key
+   atst = at.securetunnels.create()
+   print(f"SecureTunnel Created: {atst.key}")
+   ```
+
+2. **查看所有 ATST** 列出所有已创建的 ATST 信息。
+
+   ```python
+       In [2]: at.securetunnels
+       Out[2]: 
+       key                         created_at           
+       atst_p94PzQeMetZxV2W3VC    2024-01-06 12:10:00  
+       atst_p94PzQeMetZxV2W3VC    2024-01-07 05:35:03  
+       atst_p94PzQeMetZxV2W3VC  2024-01-07 05:46:21  
+       atst_p94PzQeMetZxV2W3VC  2024-01-07 10:34:15
+   ```
 
 3. 获取 ATST 的配置信息
     
     ```python
         In [2]: at.securetunnels.get('atst_p94PzQeMetZxV2W3VC')
         Out[2]: {
         "id": "atst_p94PzQeMetZxV2W3VC",
@@ -333,7 +336,196 @@
 
 4. 获取某个ATST上绑定的所有Link
   
 ```python
     In [3]: at.securetunnels.get('atst_p94PzQeMetZxV2W3VC').links
     Out[3]:
 ``` 
+
+### 5.6 设置角色和权限
+
+AskTable 的访问控制是通过访问策略定义和角色定义来实现的。 
+
+
+1. 创建访问策略
+访问策略（Access Policy）定义的是某个人能访问（或不能访问）的数据集。
+
+   ```python
+   from asktable import AskTable 
+   at = AskTable(token='your_token')
+   
+   # 允许访问用户表，但只能访问某个城市的数据
+   policy = at.policies.create(
+       permission="allow",
+       name="user_policy_shanghai",
+       datasource_ids="ds_2MSqC5EUFawpK0nVOg8MXN,ds_34LANTyIJi0srCJrHFxRZ",
+       tables_regex_pattern="^(user)_.*$",
+       fields_regex_pattern=".*",
+       rows_filters=[
+           "ds_1.*.user.city_id = {city_id}"
+       ]
+   )
+   print(f"Policy Created: {policy.name}")
+   
+   ```
+
+2. 创建角色。这使得可以根据角色控制其数据访问权限。
+
+    ```python
+    # 创建角色示例
+    role = at.roles.create(
+       name="city_manager",
+       description="Manager role for a city",
+    )
+    print(f"Role Created: {role.name}")
+   
+    # 为角色绑定策略
+    role.attach_policies(policy_names=[policy.name])
+    
+    print(f"Policies Attached: {policy.name}")
+       
+    ```
+
+3. 通过扮演角色来发起对话。这个角色决定了用户在该会话中可以访问哪些数据。
+
+   ```python
+   # 使用角色访问数据示例
+   chat = at.chats.create(
+       ['ds_2MSqC5EUFawpK0nVOg8MXN', 'ds_34LANTyIJi0srCJrHFxRZ'],
+       {
+           "role_name": "city_manager",
+           "role_variables": {
+               "user_id": "123",
+               "city_id": "310"
+           }
+       }
+   )
+   response = chat.ask('Show me the user data for Shanghai.')
+   print(response)
+   ```
+   
+4. 查看所有的策略
+   
+   ```python
+   In [1]: at.policies
+   Out[1]: 
+   id                          name      datasource_ids            schemas_regex_pattern    tables_regex_pattern    fields_regex_pattern    rows_filters    modified_at
+   policy_7ANpC68WihJm0zkyRll5Do  policy1  ds_UJDPngVNVLn7aKwvvWGTx                                                                                              2024-05-05T10:49:29
+   policy_7ANpC68WihJm0zkyRll5Do  policy2  ds_UJDPngVNVLn7aKwvvWGTx                                                                                              2024-05-05T10:49:29
+   ```
+   
+5. 查看和管理某个策略
+    ```python
+    # 根据ID
+    policy1 = at.policies.get('policy_7ANpC68WihJm0zkyRll5Do')
+    # 根据Name
+    policy2 = at.policies.get(name='policy1')
+    # 获取最新的策略
+    policy3 = at.policies.latest
+    
+    # 修改
+    policy1.update(name='policy2', fields_regex_pattern='.*')
+    
+    # 删除
+    policy1.delete()
+    ```
+
+6. 查看所有的角色
+   ```python
+   In [8]: at.roles
+   Out[8]: 
+   id                           name    modified_at          
+   role_41OHLVTiDZNDBukDhrMiJk  role1   2024-05-05T10:53:34
+   ```
+
+7. 获取和管理某个角色
+    ```python
+    # 根据ID
+    role = at.roles.get('role_41OHLVTiDZNDBukDhrMiJk')
+    # 根据Name
+    role = at.roles.get(name='role1')
+    # 获取最新的角色
+    role = at.roles.latest
+    
+    # 修改角色
+    role.update(name='role2')
+    
+    # 删除角色
+    role.delete()
+    ```
+   
+8. 获取和管理某个角色的策略
+   ```python
+   # 全部
+   policies = role.policies
+   # 根据策略ID
+   policy = role.policies.get('policy_6m2DGTvM6tC64cyF2cYjAJ') 
+   
+   # 删除策略
+   policy.delete()
+   ```
+
+## 6. 错误处理
+
+### 6.0 OK 正确返回
+    
+```python
+In [25]: at.chats.get('chat_5lSeeLn7KMScVCYjVNewFS').messages
+Out[25]: 
+id                          created        role    content                                                                                           reply_to_msg_id
+msg_43ZYqK5kMjr3xMIPqxgVxq  5 minutes ago  human   最晚入职是谁
+msg_4Bf8mRqPYk5U9bS99qFsT4  4 minutes ago  ai      [OK-7s] 最晚入职的员工是陈敏，员工编号为5，身份证号为100200200001012222，联系电话为13800000001。  msg_43ZYqK5kMjr3xMIPqxgVxq
+
+In [26]: at.chats.get('chat_5lSeeLn7KMScVCYjVNewFS').messages.get('msg_4Bf8mRqPYk5U9bS99qFsT4')
+Out[26]: [msg_4Bf8mRqPYk5U9bS99qFsT4] [ai] [OK-7s] 最晚入职的员工是陈敏，员工编号为5，身份证号为100200200001012222，联系电话为13800000001。   [4 minutes ago]>
+
+In [27]: msg = at.chats.get('chat_5lSeeLn7KMScVCYjVNewFS').messages.get('msg_4Bf8mRqPYk5U9bS99qFsT4')
+
+In [28]: msg.answer.to_dict()
+Out[28]: 
+{'status': 'OK',
+ 'elapsed_time': 7,
+ 'text': '最晚入职的员工是陈敏，员工编号为5，身份证号为100200200001012222，联系电话为13800000001。',
+ 'files': None,
+ 'charts': None,
+ 'query_insights': [{'question': '查询数据库中最晚入职的员工信息。\r\n\r',
+   'datasource': 'ds_1pv7a93n2LQr5DHHX64ECI',
+   'results': [{'query': 'SELECT * FROM test.employees ORDER BY employee_id DESC LIMIT 1',
+     'result_info': {'row_count': 1,
+      'column_count': 4,
+      'columns': ['employee_id', 'name', 'id_number', 'phone_number']},
+     'query_time_ms': 38}],
+   'query_time': 3}],
+ 'payload': {'recognized_addresses': None, 'error_type': '', 'error_msg': ''}}
+```
+
+### 6.1 QAErrorCannotHandle 无法处理
+
+```python
+
+In [18]: at.chats.latest.messages
+Out[18]: 
+id                          created    role    content                      reply_to_msg_id
+msg_40rEzS9Pi6cKA910qZe9PN  Just now   human   年龄最大的员工是谁
+msg_3zbA7gvdJFiUG0x5xM7fAj  Just now   ai      [ERROR-6s] 没有找到相关信息  msg_40rEzS9Pi6cKA910qZe9PN
+
+In [19]: msg = at.chats.latest.messages.get('msg_3zbA7gvdJFiUG0x5xM7fAj')
+
+In [20]: msg
+Out[20]: [msg_3zbA7gvdJFiUG0x5xM7fAj] [ai] [ERROR-6s] 没有找到相关信息   [Just now]>
+
+In [21]: msg.answer.to_dict()
+Out[21]: 
+{'status': 'ERROR',
+ 'elapsed_time': 6,
+ 'text': '没有找到相关信息',
+ 'files': None,
+ 'charts': None,
+ 'query_insights': None,
+ 'payload': {'recognized_addresses': None,
+  'error_type': 'QAErrorCannotHandle',
+  'error_msg': "The 'age' field is not present in the employees table metadata provided."}}
+
+```
+
+
+以上步骤展示了如何在 AskTable 中通过角色和权限管理功能来精细控制数据访问权限，从而确保数据隐私和安全。
```

## Comparing `asktable-0.14.3.dist-info/RECORD` & `asktable-0.17.0.dist-info/RECORD`

 * *Files 22% similar despite different names*

```diff
@@ -1,34 +1,36 @@
 asktable/__init__.py,sha256=12mHQ4Yrr7_vY7ilhc6_tdOtuclBWPWj88YFIiTTU6I,86
 asktable/api.py,sha256=e5XbDpNv3V0OVdpUin6xhkA1xW0u-Jik5wFlS_2ZkiY,2180
-asktable/cli.py,sha256=oNhuGdEB_jD_1ru40CcLhsul2VVaWq_VuiEYVbO-uwY,2138
-asktable/client.py,sha256=vZHdgqeRvRwRR5K1p450aoVfNZlKPH--aT2HUg8lcvc,1022
+asktable/cli.py,sha256=1aXfzeaLRpYJWp5c5Uhzv3Upb8AprxUOhY6YGCi_ulY,2213
+asktable/client.py,sha256=7wMUQmgVUSujlOKAsupYlazuz73VmAmCR7TXEFGFMw8,1395
 asktable/exceptions.py,sha256=HUys_aPowtoLqjO4XhANXBQCUUpty1zLxV4fWPqBkLc,41
 asktable/log.py,sha256=CIRsQtXMB24sD5fFsUn2hxlEVJB33Ej8TIQKyET2pQ8,875
 asktable/upload.py,sha256=ZctBvZtKnBZWucRXzvdp25zBNGz3eQ6PAfdhzLzfMUU,1492
-asktable/models/__init__.py,sha256=pBkKlyvFBkoOtuaBJkIz5bixHZovMuu184JGnPWBUsM,248
-asktable/models/client_base.py,sha256=W09CNgGrquuxDoWhk-2A7bZkdfS9FnjhTdM-KTEGvUY,2992
-asktable/models/client_chat.py,sha256=rhkfO5LUZuMhdemZBdtIEvA1C6YNjZlWVvAlc7YqHyQ,2571
-asktable/models/client_ds.py,sha256=HV8qIpNihuWR7GQw5vwV94EvqQRBdCwTrz4athUak8A,10755
-asktable/models/client_msg.py,sha256=hWJ8ZoZ2scasPl3EbxHWvixsnRly0AHa28jgonLiYUk,1270
+asktable/models/__init__.py,sha256=AmMMCVGsemK9FuAjULJwsmV1Hk3LkzoVjECN9AkYgoI,584
+asktable/models/client_auth.py,sha256=8QfXXDkH-pG_3nQnlEs_VFVgpahVxYvpdRdnV4lQYI4,4495
+asktable/models/client_base.py,sha256=txj6G1zz3jbysnX-AGPJIuuFNyMmWYLF2VHtjP_aY8c,4023
+asktable/models/client_chat.py,sha256=33u0Jv_FzbLWINNVqOFYtYXL_kNgiF7vmwrduVtHq1w,2785
+asktable/models/client_ds.py,sha256=YGdTx2eAxrlnNnlxakYUoRkIkq5XN8tQ9rZvUjICDGI,10830
+asktable/models/client_msg.py,sha256=TBaiiGELjtNBq6Lp40Hs0heMHNG5ik0kTRLHeBwXO2U,1290
 asktable/models/client_run.py,sha256=YEu-lhVUPamwN9yLJLLldZXTBppIOMIMZ6wOmoxPsc4,885
-asktable/models/client_securetunnel.py,sha256=8DrcpaYqLnJprPMfrK8ewW1J1cHv_WW5_BKYkpfPtNU,1397
+asktable/models/client_securetunnel.py,sha256=RXC0pTP_L9F1F-iqJ60ClQLVH6ntYvEYem4gCfjHbjk,1597
 atcommon/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-atcommon/tools.py,sha256=VARJtN379b-GBcsQspAbHyAvYnIhLkEKhExMT3j7Y0E,3828
-atcommon/version.py,sha256=qLUDLSXToqkUDxNzIMgECiICx-gY_MqFkZtSv5D_v20,16
+atcommon/tools.py,sha256=QzS75_UUz3NLH_LCUL5uNejcZereYT4Q_A5SqP30nq8,3964
+atcommon/version.py,sha256=8_h83RPSvFbwcnc0Eb-1eQnWHleOCpi3EbqoRyp1ljQ,16
 atcommon/exceptions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atcommon/exceptions/client.py,sha256=9NRkVMHEBdCfiaTvz2p5knT6gWwAzhksZJf0yeyo9rI,1402
 atcommon/exceptions/server.py,sha256=BSlYmdfDasoAq6oK9fyGhws3EBPII_hkHpx_JQmMdAY,95
-atcommon/exceptions/server_base.py,sha256=ih_9p2EeUhHLCS49IctgE7_wA8Z3hqic5N_vzUmhRxk,2837
-atcommon/exceptions/server_plugins.py,sha256=fjQr0aEVT0vlj7RFLErIuEdjTV4LY2R7Sw1K5LPYR2U,764
-atcommon/models/__init__.py,sha256=EiUwkIMdsdvZzAlDSDD7509mngAjckTBp65xICcASbk,526
-atcommon/models/base.py,sha256=UVM9dKL22-k4k44H6DYQeNIe35vJ1Vg0ppGDZiVDiIU,731
-atcommon/models/bi.py,sha256=WVkrlkMMkSeV5WhoNr88r1qmEPpAW3HA19YysF5-4j0,4918
-atcommon/models/chat.py,sha256=Si_eo8H8h_NtIOc76qhXoYcHp_tPMavud2sEnUXEejo,1069
-atcommon/models/datasource.py,sha256=Qv-IIC9hDGXrWe5s__4U_f51QNDi9BCMJrf42cUJ5Tg,1424
-atcommon/models/meta.py,sha256=OZesut61aJuotvzhj6k92tvcvaOut6E5v5rNNpFzVGo,27794
-atcommon/models/securetunnel.py,sha256=CG-Yn4dHtsHTZALCFR24W9SeF12ENl5mMn608my3vjI,819
-asktable-0.14.3.dist-info/METADATA,sha256=e-6yWEYZGWflQxYcf6sXaa9b2GdYVs6MFWcUVgoOyPI,11702
-asktable-0.14.3.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
-asktable-0.14.3.dist-info/entry_points.txt,sha256=OS7zXFo5f2wYttNLFf6EScGBaN_2XtYbV_Fl_C3RhY8,47
-asktable-0.14.3.dist-info/top_level.txt,sha256=j_dz8lioIJZMGAy7UUdXv0ytGGhh8HFsGhSXaULxT4M,18
-asktable-0.14.3.dist-info/RECORD,,
+atcommon/exceptions/server_base.py,sha256=rtFZC4x7J0FlNkij3ZJPxWKtL3HEha9vFy-hcURdCQU,4174
+atcommon/exceptions/server_plugins.py,sha256=GTi89Ws7QZmn6p7IrYovu-7wkWSkGridPNZlYfrSAjQ,656
+atcommon/models/__init__.py,sha256=yf9y4iejr6g0kcjbkWnaUlEts7XN3ehWBIvzwZ7g5UI,763
+atcommon/models/auth.py,sha256=yfn67V-JL4eImCq4CxuCUlafI2GFlYMrWSgM8gPBVaw,1095
+atcommon/models/base.py,sha256=yRaaii4IOAIfKNN1fV2OmR-SesdX_2pj6Vpcx-Ecr0E,1063
+atcommon/models/chat.py,sha256=uMwAz3-Eofy71sSiSpS5EAS6S-IZc1Orbup1owB7vl0,1326
+atcommon/models/datasource.py,sha256=gzM4ZB02YrOjuj6wYD46wUgK53QQjecZGb0fmS_a-Y4,1594
+atcommon/models/meta.py,sha256=Rz5epvQwY63kvGa6KGCh1yPf83sqmGnkydFlZ2vwjsA,37127
+atcommon/models/qa.py,sha256=Q5ipN1L3SsUQNUd1iwVxeJe38p0fpZzSZ6zRS9v_758,5061
+atcommon/models/securetunnel.py,sha256=n5duS3dduaDNPv_Y0r0M6zOc9hD05OPM4rtR6o7O3nw,1137
+asktable-0.17.0.dist-info/METADATA,sha256=eci2BaHr1ahW_XhXCATSAkKIKgB8JZ7b4ximGs9Y3m4,18288
+asktable-0.17.0.dist-info/WHEEL,sha256=Xo9-1PvkuimrydujYJAjF7pCkriuXBpUPEjma1nZyJ0,92
+asktable-0.17.0.dist-info/entry_points.txt,sha256=OS7zXFo5f2wYttNLFf6EScGBaN_2XtYbV_Fl_C3RhY8,47
+asktable-0.17.0.dist-info/top_level.txt,sha256=j_dz8lioIJZMGAy7UUdXv0ytGGhh8HFsGhSXaULxT4M,18
+asktable-0.17.0.dist-info/RECORD,,
```

